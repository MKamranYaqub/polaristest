@import './variables';
@import './controls';

// Calculator-specific SCSS (SLDS-compliant)
.calculator-container {
  font-family: $token-font-family;
  padding: $spacing-xs;
  width: 100%;
  max-width: none; /* allow the container to fill the available content column */
  margin: 0;
  box-sizing: border-box;
}

// Slider input styling
input[type="range"] {
  &::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #0176d3;
    cursor: pointer;
    border: 2px solid #ffffff;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    transition: all 0.15s ease;

    &:hover {
      background: #014486;
      transform: scale(1.1);
    }

    &:active {
      transform: scale(0.95);
    }
  }

  &::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #0176d3;
    cursor: pointer;
    border: 2px solid #ffffff;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    transition: all 0.15s ease;

    &:hover {
      background: #014486;
      transform: scale(1.1);
    }

    &:active {
      transform: scale(0.95);
    }
  }

  &:disabled {
    opacity: 0.4;
    cursor: not-allowed;

    &::-webkit-slider-thumb {
      cursor: not-allowed;
    }

    &::-moz-range-thumb {
      cursor: not-allowed;
    }
  }
}

// Top filters row (inline, no card)
.top-filters {
  display: flex;
  align-items: flex-end;
  gap: $spacing-md;
  margin-bottom: $spacing-md;
  padding: $spacing-md;
  background: $token-color-surface;
  border: 1px solid $token-color-border-subtle;
  border-radius: $token-radius-sm;
  flex-wrap: wrap;

  .slds-form-element {
    flex: 0 0 auto;
    min-width: 150px;

    &:nth-child(2),
    &:nth-child(3) {
      min-width: 280px;
    }
  }

  .tier-display {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin-left: 0px;
    
    .tier-label {
      font-size: 0.75rem;
      color: $token-text-secondary;
      margin-bottom: var(--token-spacing-xs);
    }
    
    .tier-value {
      font-size: 1rem;
      color: $token-text-primary;
    }
  }
}

// Collapsible section (accordion-like)
.collapsible-section {
  background: $token-color-surface;
  border: 1px solid $token-color-border-subtle;
  border-radius: $token-radius-sm;
  margin-bottom: $spacing-md;
  overflow: hidden;
  box-shadow: var(--token-shadow-card);
}

.collapsible-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--token-spacing-md) $spacing-md;
  background: $token-color-surface;
  cursor: pointer;
  user-select: none;
  transition: background 0.15s ease;
  
  &:hover {
    background: var(--token-layer-hover, #f3f2f2);
  }
  
  // When section is expanded, use same color as hover state
  &.expanded {
    background: var(--token-layer-hover, #f3f2f2);
  }
  
  .header-title {
    font-size: 0.9375rem;
    font-weight: 600;
    color: $token-text-primary;
    margin: 0;
  }
  
  .chevron-icon {
    width: 1rem;
    height: 1rem;
    transition: transform 0.2s ease;
    fill: currentColor;
    color: $token-text-secondary;
    flex-shrink: 0;
  }
}

.collapsible-body {
  padding: $spacing-md;
  background: $token-color-surface;
  
  &.collapsed {
    display: none;
  }
}

// Criteria grid (responsive 4-column)
.criteria-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: $spacing-md;
  
  @media (max-width: 1200px) {
    grid-template-columns: repeat(3, 1fr);
  }
  
  @media (max-width: 900px) {
    grid-template-columns: repeat(2, 1fr);
  }
  
  @media (max-width: 600px) {
    grid-template-columns: 1fr;
  }
}

// Loan details grid (responsive multi-column)
.loan-details-grid {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: var(--token-form-field-gap);
  margin-bottom: $spacing-md;

  .loan-info-box {
    padding: var(--token-spacing-xs) var(--token-spacing-sm);
    background-color: var(--token-info-bg);
    border: 1px solid var(--token-info);
    border-radius: var(--token-radius-sm);
    display: flex;
    align-items: center;
    gap: var(--token-spacing-xs);
    min-height: 50px;

    .help-icon {
      flex-shrink: 0;
      margin-left: 0;
      width: var(--token-icon-lg);
      height: var(--token-icon-lg);
    }

    .help-icon svg {
      width: var(--token-icon-lg);
      height: var(--token-icon-lg);
    }

    .info-text {
      font-size: var(--token-font-size-sm);
      line-height: var(--token-line-height-base);
      color: var(--token-text-primary);
    }
  }
  
  .slds-form-element {
    min-width: 0; // Prevent grid items from overflowing
  }

  .slds-input,
  .slds-select {
    width: 100%;
    min-width: 0;
    box-sizing: border-box;
  }

  // LTV slider styling to match input fields
  .ltv-slider {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    outline: none;
    -webkit-appearance: none;
    appearance: none;
    cursor: pointer;

    &::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: $token-color-interactive;
      cursor: pointer;
      border: 2px solid $token-color-surface;
      box-shadow: $token-shadow-soft;
    }

    &::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: $token-color-interactive;
      cursor: pointer;
      border: 2px solid $token-color-surface;
      box-shadow: $token-shadow-soft;
    }
  }
  
  @media (max-width: 1600px) {
    grid-template-columns: repeat(5, minmax(0, 1fr));
  }
  
  @media (max-width: 1400px) {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
  
  @media (max-width: 1200px) {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
  
  @media (max-width: 900px) {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
  
  @media (max-width: 600px) {
    grid-template-columns: minmax(0, 1fr);
  }
}

// Styling for first-charge warning: remove outer border and color input border only
.first-charge-warning {
  background: $token-warning-bg;
  padding: var(--token-spacing-sm);
  border-radius: 4px;
  border: none; /* remove outside border as requested */
  display: flex;
  flex-direction: column;
  justify-content: center;
  min-height: 48px; /* align visually with neighboring inputs */
}

.first-charge-warning .first-charge-label {
  font-weight: 600;
}

.first-charge-warning .first-charge-hint {
  font-size: 0.8em;
  color: $token-text-helper;
  margin-left: var(--token-spacing-xs);
}

/* Only change the input's border color; do not add an outer wrapper border */
.first-charge-warning .first-charge-input,
.first-charge-warning .slds-input {
  border-color: $token-color-accent; /* accent colour for input border */
  box-shadow: none;
}

@media (max-width: 600px) {
  .first-charge-warning {
    grid-column: 1 / -1; /* full width on small screens */
  }
}

// Fees section - full width below main grid
.fees-section {
  border-top: 1px solid $token-color-border-subtle;
  padding-top: $spacing-md;
  margin-top: $spacing-md;

  .fees-row {
    display: grid;
    // Three columns: [toggle] [Fee calculated as] [Additional fee amount]
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 0; // Remove gap between fee fields
    align-items: start;

    .slds-form-element {
      min-width: 0;
      padding-right: $spacing-md; // Add padding to create controlled spacing
    }

    .slds-input,
    .slds-select {
      width: 100%;
      min-width: 0;
      box-sizing: border-box;
    }

    // Keep the layout stable when toggle is off
    .fees-collapsed {
      visibility: hidden;
      pointer-events: none;
    }

    @media (max-width: 1200px) {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    @media (max-width: 768px) {
      grid-template-columns: minmax(0, 1fr);
    }
  }

  .modern-switch {
    // Toggle occupies a single column so the next field is immediately adjacent
    grid-column: span 1;

    @media (max-width: 1200px) {
      // With 2 columns at this breakpoint, keep the toggle to 1 column as well
      grid-column: span 1;
    }

    @media (max-width: 768px) {
      grid-column: span 1;
    }
  }
}


// Rates display
.rates-display {
  padding: $spacing-md;
  border-top: 1px solid $token-color-border-subtle;

  .rates-count {
    font-size: 0.875rem;
    color: $token-text-secondary;
    margin-bottom: $spacing-md;
  }

  .rate-item {
    padding: var(--token-spacing-sm) 0;
    border-bottom: 1px solid $token-color-border-subtle;
    font-size: 0.9375rem;

    &:last-child {
      border-bottom: none;
    }

    strong {
      font-weight: 600;
      color: $token-text-primary;
    }

    .rate-fee {
      color: $token-text-secondary;
      font-size: 0.875rem;
    }
  }

  .no-rates {
    padding: $spacing-md;
    text-align: center;
    color: $token-text-secondary;
    font-style: italic;
  }
}

// Info icon + tooltip
.info-icon-wrapper {
  position: relative;
  display: inline-flex;
  align-items: center;
  margin-left: var(--token-spacing-sm);
  
  .info-icon-button {
    border: none;
    background: transparent;
    padding: 0;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    
    svg {
      width: 14px;
      height: 14px;
      fill: #0176d3; // Salesforce blue
      color: #0176d3;
    }
    
    &:hover svg {
      fill: #014486;
      color: #014486;
    }
  }
  
  .info-tooltip {
    position: absolute;
    left: 110%;
    top: 50%;
    transform: translateY(-50%);
    min-width: 180px;
    max-width: 320px;
    background: $token-color-surface;
    color: $token-text-primary;
    border: 1px solid $token-color-interactive;
    border-radius: $token-radius-sm;
    padding: var(--token-spacing-sm) var(--token-spacing-md);
    box-shadow: $token-shadow-strong;
    z-index: 1100;
    white-space: normal;
    font-size: 0.8125rem;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 150ms ease, visibility 150ms ease;
    
    &.visible {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }
  }
}

// ============================================
// BRANDED RESULTS TABLE STYLING (MFS theme)
// ============================================
.results-table-wrapper {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  border-radius: var(--token-radius-md);
  
  table {
    border-collapse: separate;
    border-spacing: 0;
    width: 100%;
    background: var(--token-layer-surface);
    font-variant-numeric: tabular-nums;
  }
  
  // Sticky header
  thead {
    position: sticky;
    top: 0;
    z-index: var(--token-z-sticky, 1020);
  }
  
  thead th {
    text-align: center;
    font-weight: 600;
    padding: var(--token-spacing-md) var(--token-spacing-lg) !important;
    border-bottom: 2px solid var(--mfs-brand-navy);
    white-space: nowrap;
  }
  
  // Label column (first column header)
  thead th.th-label {
    color: var(--results-header-label-text) !important;
    background: var(--results-header-label-bg) !important;
    text-align: left;
    position: sticky;
    left: 0;
    z-index: calc(var(--token-z-sticky, 1020) + 1);
  }
  
  // Data column headers - colors set via inline styles for dynamic support
  thead th.th-data-col {
    text-align: center;
    font-weight: 600;
  }
  
  // Legacy class support - Fusion column header (default)
  thead th.th-fusion {
    background: var(--results-header-col1-bg) !important;
    color: var(--results-header-col1-text) !important;
  }
  
  // Legacy class support - Variable Bridge column header (default)
  thead th.th-variable {
    background: var(--results-header-col2-bg) !important;
    color: var(--results-header-col2-text) !important;
  }
  
  // Legacy class support - Fixed Bridge column header (default)
  thead th.th-fixed {
    background: var(--results-header-col3-bg) !important;
    color: var(--results-header-col3-text) !important;
  }
}

// BTL Calculator specific header colors
.results-table-wrapper[data-calculator-type="btl"] {
  thead th.th-label {
    color: var(--results-header-btl-label-text) !important;
    background: var(--results-header-btl-label-bg) !important;
  }
  // Legacy class support
  thead th.th-fusion {
    background: var(--results-header-btl-col1-bg) !important;
    color: var(--results-header-btl-col1-text) !important;
  }
  thead th.th-variable {
    background: var(--results-header-btl-col2-bg) !important;
    color: var(--results-header-btl-col2-text) !important;
  }
  thead th.th-fixed {
    background: var(--results-header-btl-col3-bg) !important;
    color: var(--results-header-btl-col3-text) !important;
  }
}

// Bridge Calculator specific header colors
.results-table-wrapper[data-calculator-type="bridge"] {
  thead th.th-label {
    color: var(--results-header-bridge-label-text) !important;
    background: var(--results-header-bridge-label-bg) !important;
  }
  thead th.th-fusion {
    background: var(--results-header-bridge-col1-bg) !important;
    color: var(--results-header-bridge-col1-text) !important;
  }
  thead th.th-variable {
    background: var(--results-header-bridge-col2-bg) !important;
    color: var(--results-header-bridge-col2-text) !important;
  }
  thead th.th-fixed {
    background: var(--results-header-bridge-col3-bg) !important;
    color: var(--results-header-bridge-col3-text) !important;
  }
}

// Core Calculator specific header colors
.results-table-wrapper[data-calculator-type="core"] {
  thead th.th-label {
    color: var(--results-header-core-label-text) !important;
    background: var(--results-header-core-label-bg) !important;
  }
  thead th.th-fusion {
    background: var(--results-header-core-col1-bg) !important;
    color: var(--results-header-core-col1-text) !important;
  }
  thead th.th-variable {
    background: var(--results-header-core-col2-bg) !important;
    color: var(--results-header-core-col2-text) !important;
  }
  thead th.th-fixed {
    background: var(--results-header-core-col3-bg) !important;
    color: var(--results-header-core-col3-text) !important;
  }
}

// Results table styling continued (body styles)
.results-table-wrapper {
  // Table body styling
  tbody tr {
    transition: background-color 0.15s ease;
  }
  
  // Zebra striping
  tbody tr:nth-child(even) {
    background: var(--token-ui-background-subtle, #fafafa);
  }
  
  // Hover highlight
  tbody tr:hover {
    background: var(--mfs-brand-orange-100, #FFF3DF) !important;
  }
  
  // Sticky first column (row labels)
  tbody th[scope='row'],
  tbody td:first-child {
    position: sticky;
    left: 0;
    z-index: var(--token-z-base, 1);
    background: var(--token-ui-background-neutral, #f4f6f9);
    font-weight: 600;
    text-align: left;
  }
  
  // Cell styling
  td, th {
    padding: var(--token-spacing-sm) var(--token-spacing-md);
    border-bottom: 1px solid var(--token-ui-border-subtle, #e0e6ed);
    vertical-align: middle;
  }
  
  // Center-align data columns
  td:not(:first-child) {
    text-align: center;
  }
  
  // Right-align currency and percentage values for readability
  td.text-align-right {
    text-align: right;
  }
}

// Helper text below inputs
.helper-text {
  margin-top: var(--token-spacing-xs);
  font-size: var(--token-font-size-sm);
  color: $token-text-secondary;
  line-height: 1.4;
}

// Fee inline row
.fee-inline-row {
  display: flex;
  align-items: center;
  gap: $spacing-md;
  margin-top: var(--token-spacing-sm);
  flex-wrap: wrap;
}

// Compact form element for fees
.fee-form-element {
  min-width: 140px;
  flex: 0 0 auto;
}

// Required asterisk
.required-asterisk {
  color: $token-color-critical;
  margin-right: var(--token-spacing-xs);
  font-weight: 600;
}

/* Responsive tweaks for tablet and mobile */
@media (max-width: 900px) {
  .calculator-container {
    padding: $spacing-sm;
    margin: 0;
  }

  /* make top filters stack nicely on small screens */
  .top-filters {
    padding: $spacing-sm;
    
    .slds-form-element {
      flex: 1 1 100%;
      min-width: 0 !important;
    }
  }

  .range-toggle-buttons .range-button {
    padding: var(--token-spacing-md) var(--token-spacing-lg);
    font-size: 0.95rem;
  }

  .collapsible-header {
    padding: var(--token-spacing-sm) $spacing-sm;
    
    .header-title {
      font-size: 0.95rem;
    }
  }

  .collapsible-body {
    padding: $spacing-sm;
  }

  /* ensure results table becomes more compact */
  .results-section table {
    font-size: 0.95rem;
  }

  .rates-display .rate-item {
    font-size: 0.95rem;
  }
}

@media (max-width: 600px) {
  .calculator-container {
    padding: $spacing-xs;
  }

  .top-filters {
    padding: $spacing-xs;
    gap: $spacing-xs;
    margin-bottom: $spacing-xs;
  }

  .criteria-grid {
    gap: $spacing-xs;
  }

  .loan-details-grid {
    gap: $spacing-xs;
  }

  .collapsible-section {
    margin-bottom: $spacing-xs;
  }

  .collapsible-header {
    padding: var(--token-spacing-sm) $spacing-xs;
    
    .header-title {
      font-size: 0.9rem;
    }
    
    .chevron-icon {
      width: 0.9rem;
      height: 0.9rem;
    }
  }

  .collapsible-body {
    padding: $spacing-xs;
  }

  .slds-form-element {
    margin-bottom: $spacing-xs;
  }

  .slds-form-element__label {
    font-size: 0.85rem;
  }

  .slds-input, .slds-select {
    font-size: 0.95rem;
    padding: var(--token-spacing-sm) var(--token-spacing-md);
  }

  .slds-table {
    font-size: 0.9rem;
    
    td, th {
      padding: var(--token-spacing-sm) var(--token-spacing-sm);
    }
  }

  .range-toggle-buttons .range-button {
    padding: var(--token-spacing-sm) var(--token-spacing-md);
    font-size: 0.9rem;
  }

  /* Make fee toggle more compact on mobile */
  .modern-switch {
    .switch-label {
      font-size: 0.85rem;
    }
  }
}
